<!DOCTYPE html>
<html lang="en-US" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>ErrorLens.ErrorHandling -- Architecture Guide | ErrorLens.ErrorHandling</title>
    <meta name="description" content="Consistent, structured error responses for ASP.NET Core REST APIs">
    <meta name="generator" content="VitePress v1.6.4">
    <link rel="preload stylesheet" href="/error-handling-dotnet/1.3.1/assets/style.CHwfCh_C.css" as="style">
    <link rel="preload stylesheet" href="/error-handling-dotnet/1.3.1/vp-icons.css" as="style">
    
    <script type="module" src="/error-handling-dotnet/1.3.1/assets/app.CmJhBJwC.js"></script>
    <link rel="preload" href="/error-handling-dotnet/1.3.1/assets/inter-roman-latin.Di8DUHzh.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/error-handling-dotnet/1.3.1/assets/chunks/framework.-Q5tCgKN.js">
    <link rel="modulepreload" href="/error-handling-dotnet/1.3.1/assets/chunks/theme.VSDt2cvu.js">
    <link rel="modulepreload" href="/error-handling-dotnet/1.3.1/assets/chunks/katex.CBSAILhF.js">
    <link rel="modulepreload" href="/error-handling-dotnet/1.3.1/assets/chunks/dagre-6UL2VRFP.Dkwkgnna.js">
    <link rel="modulepreload" href="/error-handling-dotnet/1.3.1/assets/chunks/cose-bilkent-S5V4N54A.BFLNRjm2.js">
    <link rel="modulepreload" href="/error-handling-dotnet/1.3.1/assets/chunks/c4Diagram-YG6GDRKO.DH1iOZuU.js">
    <link rel="modulepreload" href="/error-handling-dotnet/1.3.1/assets/chunks/flowDiagram-NV44I4VS.C7j6bfNw.js">
    <link rel="modulepreload" href="/error-handling-dotnet/1.3.1/assets/chunks/erDiagram-Q2GNP2WA.CXZwylLx.js">
    <link rel="modulepreload" href="/error-handling-dotnet/1.3.1/assets/chunks/gitGraphDiagram-V2S2FVAM.BNccvqWn.js">
    <link rel="modulepreload" href="/error-handling-dotnet/1.3.1/assets/chunks/ganttDiagram-JELNMOA3.BIRBcxmd.js">
    <link rel="modulepreload" href="/error-handling-dotnet/1.3.1/assets/chunks/infoDiagram-HS3SLOUP.BunK09_m.js">
    <link rel="modulepreload" href="/error-handling-dotnet/1.3.1/assets/chunks/pieDiagram-ADFJNKIX.CiV0rlpu.js">
    <link rel="modulepreload" href="/error-handling-dotnet/1.3.1/assets/chunks/quadrantDiagram-AYHSOK5B.D1ZL8Z5L.js">
    <link rel="modulepreload" href="/error-handling-dotnet/1.3.1/assets/chunks/xychartDiagram-PRI3JC2R.MFayFV8u.js">
    <link rel="modulepreload" href="/error-handling-dotnet/1.3.1/assets/chunks/requirementDiagram-UZGBJVZJ.CtZOQvXe.js">
    <link rel="modulepreload" href="/error-handling-dotnet/1.3.1/assets/chunks/sequenceDiagram-WL72ISMW.Y2saIwHo.js">
    <link rel="modulepreload" href="/error-handling-dotnet/1.3.1/assets/chunks/classDiagram-2ON5EDUG.BE_HRuKV.js">
    <link rel="modulepreload" href="/error-handling-dotnet/1.3.1/assets/chunks/classDiagram-v2-WZHVMYZB.BE_HRuKV.js">
    <link rel="modulepreload" href="/error-handling-dotnet/1.3.1/assets/chunks/stateDiagram-FKZM4ZOC.b02gOHJx.js">
    <link rel="modulepreload" href="/error-handling-dotnet/1.3.1/assets/chunks/stateDiagram-v2-4FDKWEC3._7q641Ry.js">
    <link rel="modulepreload" href="/error-handling-dotnet/1.3.1/assets/chunks/journeyDiagram-XKPGCS4Q.DnwaLoeu.js">
    <link rel="modulepreload" href="/error-handling-dotnet/1.3.1/assets/chunks/timeline-definition-IT6M3QCI.CP9DHVzd.js">
    <link rel="modulepreload" href="/error-handling-dotnet/1.3.1/assets/chunks/mindmap-definition-VGOIOE7T.M3uEV3ch.js">
    <link rel="modulepreload" href="/error-handling-dotnet/1.3.1/assets/chunks/kanban-definition-3W4ZIXB7.wQuLW1MX.js">
    <link rel="modulepreload" href="/error-handling-dotnet/1.3.1/assets/chunks/sankeyDiagram-TZEHDZUN.DhQXjkLv.js">
    <link rel="modulepreload" href="/error-handling-dotnet/1.3.1/assets/chunks/diagram-S2PKOQOG.BW-3XFcq.js">
    <link rel="modulepreload" href="/error-handling-dotnet/1.3.1/assets/chunks/diagram-QEK2KX5R.CxniP5YJ.js">
    <link rel="modulepreload" href="/error-handling-dotnet/1.3.1/assets/chunks/blockDiagram-VD42YOAC.DbeEe-Pv.js">
    <link rel="modulepreload" href="/error-handling-dotnet/1.3.1/assets/chunks/architectureDiagram-VXUJARFQ.CMe7Uk3S.js">
    <link rel="modulepreload" href="/error-handling-dotnet/1.3.1/assets/chunks/diagram-PSM6KHXK.CwNI-3wz.js">
    <link rel="modulepreload" href="/error-handling-dotnet/1.3.1/assets/chunks/virtual_mermaid-config.DQMapWZz.js">
    <link rel="modulepreload" href="/error-handling-dotnet/1.3.1/assets/architecture.md.CfYWZbum.lean.js">
    <link rel="icon" type="image/png" href="/error-handling-dotnet/current/icon.png">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-d8b57b2d><!--[--><!--]--><!--[--><span tabindex="-1" data-v-fcbfc0e0></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-fcbfc0e0>Skip to content</a><!--]--><!----><header class="VPNav" data-v-d8b57b2d data-v-7ad780c2><div class="VPNavBar" data-v-7ad780c2 data-v-9fd4d1dd><div class="wrapper" data-v-9fd4d1dd><div class="container" data-v-9fd4d1dd><div class="title" data-v-9fd4d1dd><div class="VPNavBarTitle" data-v-9fd4d1dd data-v-9f43907a><a class="title" href="/error-handling-dotnet/1.3.1/" data-v-9f43907a><!--[--><!--]--><!--[--><img class="VPImage logo" src="/error-handling-dotnet/1.3.1/icon.png" alt data-v-ab19afbb><!--]--><span data-v-9f43907a>ErrorLens.ErrorHandling</span><!--[--><!--]--></a></div></div><div class="content" data-v-9fd4d1dd><div class="content-body" data-v-9fd4d1dd><!--[--><!--]--><div class="VPNavBarSearch search" data-v-9fd4d1dd><!--[--><!----><div id="local-search"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><span class="vp-icon DocSearch-Search-Icon"></span><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-9fd4d1dd data-v-afb2845e><span id="main-nav-aria-label" class="visually-hidden" data-v-afb2845e> Main Navigation </span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/error-handling-dotnet/1.3.1/documentation.html" tabindex="0" data-v-afb2845e data-v-815115f5><!--[--><span data-v-815115f5>Documentation</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/error-handling-dotnet/1.3.1/changelog.html" tabindex="0" data-v-afb2845e data-v-815115f5><!--[--><span data-v-815115f5>Changelog</span><!--]--></a><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-afb2845e data-v-bfe7971f><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-bfe7971f><span class="text" data-v-bfe7971f><!----><span data-v-bfe7971f>v1.3.1</span><span class="vpi-chevron-down text-icon" data-v-bfe7971f></span></span></button><div class="menu" data-v-bfe7971f><div class="VPMenu" data-v-bfe7971f data-v-20ed86d6><div class="items" data-v-20ed86d6><!--[--><!--[--><div class="VPMenuLink" data-v-20ed86d6 data-v-7eeeb2dc><a class="VPLink link vp-external-link-icon" href="https://www.nuget.org/packages/ErrorLens.ErrorHandling" target="_blank" rel="noreferrer" data-v-7eeeb2dc><!--[--><span data-v-7eeeb2dc>NuGet</span><!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-9fd4d1dd data-v-3f90c1a5><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-3f90c1a5 data-v-be9742d9 data-v-b4ccac88><span class="check" data-v-b4ccac88><span class="icon" data-v-b4ccac88><!--[--><span class="vpi-sun sun" data-v-be9742d9></span><span class="vpi-moon moon" data-v-be9742d9></span><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-9fd4d1dd data-v-ef6192dc data-v-e71e869c><!--[--><a class="VPSocialLink no-icon" href="https://github.com/AhmedV20/error-handling-dotnet" aria-label="github" target="_blank" rel="noopener" data-v-e71e869c data-v-60a9a2d3><span class="vpi-social-github"></span></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-9fd4d1dd data-v-f953d92f data-v-bfe7971f><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-bfe7971f><span class="vpi-more-horizontal icon" data-v-bfe7971f></span></button><div class="menu" data-v-bfe7971f><div class="VPMenu" data-v-bfe7971f data-v-20ed86d6><!----><!--[--><!--[--><!----><div class="group" data-v-f953d92f><div class="item appearance" data-v-f953d92f><p class="label" data-v-f953d92f>Appearance</p><div class="appearance-action" data-v-f953d92f><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-f953d92f data-v-be9742d9 data-v-b4ccac88><span class="check" data-v-b4ccac88><span class="icon" data-v-b4ccac88><!--[--><span class="vpi-sun sun" data-v-be9742d9></span><span class="vpi-moon moon" data-v-be9742d9></span><!--]--></span></span></button></div></div></div><div class="group" data-v-f953d92f><div class="item social-links" data-v-f953d92f><div class="VPSocialLinks social-links-list" data-v-f953d92f data-v-e71e869c><!--[--><a class="VPSocialLink no-icon" href="https://github.com/AhmedV20/error-handling-dotnet" aria-label="github" target="_blank" rel="noopener" data-v-e71e869c data-v-60a9a2d3><span class="vpi-social-github"></span></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-9fd4d1dd data-v-6bee1efd><span class="container" data-v-6bee1efd><span class="top" data-v-6bee1efd></span><span class="middle" data-v-6bee1efd></span><span class="bottom" data-v-6bee1efd></span></span></button></div></div></div></div><div class="divider" data-v-9fd4d1dd><div class="divider-line" data-v-9fd4d1dd></div></div></div><!----></header><div class="VPLocalNav empty fixed" data-v-d8b57b2d data-v-2488c25a><div class="container" data-v-2488c25a><!----><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-2488c25a data-v-6b867909><button data-v-6b867909>Return to top</button><!----></div></div></div><!----><div class="VPContent" id="VPContent" data-v-d8b57b2d data-v-9a6c75ad><div class="VPDoc has-aside" data-v-9a6c75ad data-v-e6f2a212><!--[--><!--]--><div class="container" data-v-e6f2a212><div class="aside" data-v-e6f2a212><div class="aside-curtain" data-v-e6f2a212></div><div class="aside-container" data-v-e6f2a212><div class="aside-content" data-v-e6f2a212><div class="VPDocAside" data-v-e6f2a212 data-v-cb998dce><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" data-v-cb998dce data-v-f610f197><div class="content" data-v-f610f197><div class="outline-marker" data-v-f610f197></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-f610f197>On this page</div><ul class="VPDocOutlineItem root" data-v-f610f197 data-v-53c99d69><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-cb998dce></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-e6f2a212><div class="content-container" data-v-e6f2a212><!--[--><!--]--><main class="main" data-v-e6f2a212><div style="position:relative;" class="vp-doc _error-handling-dotnet_1_3_1_architecture" data-v-e6f2a212><div><h1 id="errorlens-errorhandling-architecture-guide" tabindex="-1">ErrorLens.ErrorHandling -- Architecture Guide <a class="header-anchor" href="#errorlens-errorhandling-architecture-guide" aria-label="Permalink to &quot;ErrorLens.ErrorHandling -- Architecture Guide&quot;">​</a></h1><p>This document provides a comprehensive architectural overview of the <strong>ErrorLens.ErrorHandling</strong> library, a structured error handling framework for ASP.NET Core APIs. It covers the package structure, middleware pipeline, dependency injection graph, handler chain of responsibility, configuration system, and all cross-cutting concerns.</p><blockquote><p><strong>Version covered:</strong> 1.3.1 <strong>Target frameworks:</strong> .NET 6.0 through .NET 10.0 (multi-targeting) <strong>Language:</strong> C# 12</p></blockquote><hr><h2 id="table-of-contents" tabindex="-1">Table of Contents <a class="header-anchor" href="#table-of-contents" aria-label="Permalink to &quot;Table of Contents&quot;">​</a></h2><ol><li><a href="#1-package-structure">Package Structure</a></li><li><a href="#2-high-level-architecture">High-Level Architecture</a></li><li><a href="#3-error-handling-pipeline-flow">Error Handling Pipeline Flow</a></li><li><a href="#4-dependency-injection-registration">Dependency Injection Registration</a></li><li><a href="#5-handler-chain-of-responsibility">Handler Chain of Responsibility</a></li><li><a href="#6-configuration-architecture">Configuration Architecture</a></li><li><a href="#7-attribute-system-and-metadata-caching">Attribute System and Metadata Caching</a></li><li><a href="#8-serialization-and-response-writing">Serialization and Response Writing</a></li><li><a href="#9-problemdetails-generation-rfc-9457">ProblemDetails Generation (RFC 9457)</a></li><li><a href="#10-localization-architecture">Localization Architecture</a></li><li><a href="#11-telemetry-and-distributed-tracing">Telemetry and Distributed Tracing</a></li><li><a href="#12-rate-limiting-integration">Rate Limiting Integration</a></li><li><a href="#13-openapi--swagger-integration">OpenAPI / Swagger Integration</a></li><li><a href="#14-multi-targeting-strategy">Multi-Targeting Strategy</a></li><li><a href="#15-key-design-decisions">Key Design Decisions</a></li><li><a href="#16-public-interface-catalog">Public Interface Catalog</a></li></ol><hr><h2 id="_1-package-structure" tabindex="-1">1. Package Structure <a class="header-anchor" href="#_1-package-structure" aria-label="Permalink to &quot;1. Package Structure&quot;">​</a></h2><p>The solution ships as <strong>three NuGet packages</strong>, each with a distinct responsibility and target framework range.</p><div class="mermaid"></div><table tabindex="0"><thead><tr><th>Package</th><th>Target Frameworks</th><th>Purpose</th></tr></thead><tbody><tr><td><strong>ErrorLens.ErrorHandling</strong></td><td>net6.0 - net10.0</td><td>Core middleware, handlers, mappers, models, configuration, localization, telemetry, rate limiting, serialization</td></tr><tr><td><strong>ErrorLens.ErrorHandling.OpenApi</strong></td><td>net9.0 - net10.0</td><td><code>IOpenApiOperationTransformer</code> integration for the native .NET 9+ OpenAPI pipeline</td></tr><tr><td><strong>ErrorLens.ErrorHandling.Swashbuckle</strong></td><td>net6.0 - net8.0</td><td><code>IOperationFilter</code> integration for Swashbuckle/Swagger on older frameworks</td></tr></tbody></table><p>Both OpenAPI packages share the <strong>internal</strong> <code>ErrorResponseSchemaGenerator</code> class from the core package (via <code>InternalsVisibleTo</code>), ensuring schema generation logic is defined once.</p><h3 id="core-package-directory-layout" tabindex="-1">Core Package Directory Layout <a class="header-anchor" href="#core-package-directory-layout" aria-label="Permalink to &quot;Core Package Directory Layout&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>src/ErrorLens.ErrorHandling/</span></span>
<span class="line"><span>  Attributes/              -- ResponseErrorCode, ResponseStatus, ResponseErrorProperty</span></span>
<span class="line"><span>  Configuration/           -- ErrorHandlingOptions, enums, JsonFieldNamesOptions, validator</span></span>
<span class="line"><span>  Extensions/              -- ServiceCollection, ApplicationBuilder, ConfigurationBuilder</span></span>
<span class="line"><span>  Handlers/                -- IApiExceptionHandler chain + AbstractApiExceptionHandler</span></span>
<span class="line"><span>  Integration/             -- Middleware, IExceptionHandler, ErrorResponseWriter</span></span>
<span class="line"><span>  Internal/                -- ExceptionMetadataCache, StringUtils</span></span>
<span class="line"><span>  Localization/            -- IErrorMessageLocalizer + NoOp + StringLocalizer bridge</span></span>
<span class="line"><span>  Mappers/                 -- IErrorCodeMapper, IErrorMessageMapper, IHttpStatusMapper</span></span>
<span class="line"><span>  Models/                  -- ApiErrorResponse, ApiFieldError, ApiGlobalError, ApiParameterError</span></span>
<span class="line"><span>  OpenApi/                 -- ErrorResponseSchemaGenerator, OpenApiOptions (internal)</span></span>
<span class="line"><span>  ProblemDetails/          -- IProblemDetailFactory, ProblemDetailFactory, ProblemDetailResponse</span></span>
<span class="line"><span>  RateLimiting/            -- IRateLimitResponseWriter, DefaultRateLimitResponseWriter, options</span></span>
<span class="line"><span>  Serialization/           -- ApiErrorResponseConverter (custom JSON field names)</span></span>
<span class="line"><span>  Services/                -- ErrorHandlingFacade, ILoggingService, LoggingService,</span></span>
<span class="line"><span>                              IApiErrorResponseCustomizer, ILoggingFilter</span></span>
<span class="line"><span>  Telemetry/               -- ErrorHandlingActivitySource</span></span></code></pre></div><hr><h2 id="_2-high-level-architecture" tabindex="-1">2. High-Level Architecture <a class="header-anchor" href="#_2-high-level-architecture" aria-label="Permalink to &quot;2. High-Level Architecture&quot;">​</a></h2><div class="mermaid"></div><p>The architecture follows a <strong>Facade pattern</strong> at its core. The <code>ErrorHandlingFacade</code> orchestrates handler selection, customization, logging, localization, and telemetry enrichment. The <code>ErrorResponseWriter</code> handles format selection (standard JSON vs. RFC 9457 Problem Details) and serialization with cached <code>JsonSerializerOptions</code>.</p><hr><h2 id="_3-error-handling-pipeline-flow" tabindex="-1">3. Error Handling Pipeline Flow <a class="header-anchor" href="#_3-error-handling-pipeline-flow" aria-label="Permalink to &quot;3. Error Handling Pipeline Flow&quot;">​</a></h2><p>This diagram shows the complete lifecycle of an exception from throw to HTTP response.</p><div class="mermaid"></div><h3 id="key-pipeline-behaviors" tabindex="-1">Key pipeline behaviors <a class="header-anchor" href="#key-pipeline-behaviors" aria-label="Permalink to &quot;Key pipeline behaviors&quot;">​</a></h3><ul><li><strong>Guard clause:</strong> If <code>Enabled</code> is <code>false</code>, the exception is rethrown preserving the original stack trace via <code>ExceptionDispatchInfo.Capture().Throw()</code>.</li><li><strong>Handler safety net:</strong> If any handler throws during processing, the facade catches it, logs both exceptions, and returns a safe 500 response (<code>INTERNAL_SERVER_ERROR</code> / <code>&quot;An unexpected error occurred&quot;</code>) to prevent information leakage.</li><li><strong>Response-already-started guard:</strong> <code>ErrorResponseWriter</code> checks <code>HttpContext.Response.HasStarted</code> before writing, preventing <code>InvalidOperationException</code> when headers have already been sent.</li></ul><hr><h2 id="_4-dependency-injection-registration" tabindex="-1">4. Dependency Injection Registration <a class="header-anchor" href="#_4-dependency-injection-registration" aria-label="Permalink to &quot;4. Dependency Injection Registration&quot;">​</a></h2><p>The <code>AddErrorHandling()</code> extension method on <code>IServiceCollection</code> registers all core services. The registration uses <code>TryAdd*</code> methods throughout to enable idempotent calls and allow user overrides.</p><div class="mermaid"></div><h3 id="registration-semantics" tabindex="-1">Registration semantics <a class="header-anchor" href="#registration-semantics" aria-label="Permalink to &quot;Registration semantics&quot;">​</a></h3><table tabindex="0"><thead><tr><th>Method</th><th>Idempotency</th><th>Notes</th></tr></thead><tbody><tr><td><code>TryAddSingleton&lt;I, T&gt;</code></td><td>First registration wins</td><td>Used for mappers, logging, facade, writer</td></tr><tr><td><code>TryAddEnumerable(Singleton&lt;I, T&gt;)</code></td><td>One per concrete type</td><td>Used for handlers and customizers</td></tr><tr><td><code>Replace(ServiceDescriptor)</code></td><td>Overwrites existing</td><td>Used by <code>AddErrorHandlingLocalization&lt;T&gt;()</code></td></tr><tr><td><code>AddExceptionHandler&lt;T&gt;()</code></td><td>Framework method</td><td>.NET 8+ <code>IExceptionHandler</code> registration</td></tr></tbody></table><p>All services are registered as <strong>Singleton</strong>. They resolve <code>IOptions&lt;ErrorHandlingOptions&gt;.Value</code> once in their constructors, meaning configuration values are frozen at first resolution.</p><hr><h2 id="_5-handler-chain-of-responsibility" tabindex="-1">5. Handler Chain of Responsibility <a class="header-anchor" href="#_5-handler-chain-of-responsibility" aria-label="Permalink to &quot;5. Handler Chain of Responsibility&quot;">​</a></h2><p>Handlers implement <code>IApiExceptionHandler</code> and are ordered by their <code>Order</code> property (ascending -- lower values execute first). The facade iterates through them calling <code>CanHandle()</code> until one matches. If none match, the <code>IFallbackApiExceptionHandler</code> handles the exception.</p><div class="mermaid"></div><table tabindex="0"><thead><tr><th>Handler</th><th>Order</th><th>Exception Type</th><th>Status Code</th><th>Error Code</th></tr></thead><tbody><tr><td><code>AggregateExceptionHandler</code></td><td>50</td><td><code>AggregateException</code></td><td>Delegates to inner</td><td>Re-dispatches</td></tr><tr><td><code>ModelStateValidationExceptionHandler</code></td><td>90</td><td><code>ModelStateValidationException</code></td><td>400</td><td><code>VALIDATION_FAILED</code></td></tr><tr><td><code>ValidationExceptionHandler</code></td><td>100</td><td><code>ValidationException</code></td><td>400</td><td><code>VALIDATION_FAILED</code></td></tr><tr><td><code>JsonExceptionHandler</code></td><td>120</td><td><code>JsonException</code></td><td>400</td><td><code>MESSAGE_NOT_READABLE</code></td></tr><tr><td><code>TypeMismatchExceptionHandler</code></td><td>130</td><td><code>FormatException</code>, <code>InvalidCastException</code></td><td>400</td><td><code>TYPE_MISMATCH</code></td></tr><tr><td><code>BadRequestExceptionHandler</code></td><td>150</td><td><code>BadHttpRequestException</code></td><td>from exception</td><td><code>BAD_REQUEST</code></td></tr><tr><td><code>DefaultFallbackHandler</code></td><td>N/A</td><td>Any</td><td>Attribute / mapper</td><td>Attribute / mapper</td></tr></tbody></table><p><strong>Custom handlers</strong> added via <code>AddApiExceptionHandler&lt;T&gt;()</code> participate in the same chain. The <code>AbstractApiExceptionHandler</code> base class provides <code>Order =&gt; 1000</code> by default and a <code>CreateResponse()</code> helper.</p><h3 id="aggregateexception-unwrapping" tabindex="-1">AggregateException unwrapping <a class="header-anchor" href="#aggregateexception-unwrapping" aria-label="Permalink to &quot;AggregateException unwrapping&quot;">​</a></h3><p><code>AggregateExceptionHandler</code> flattens nested aggregates via <code>Flatten()</code>. If there is exactly <strong>one</strong> inner exception, it lazily resolves handlers from <code>IServiceProvider</code> (to break circular DI), skips itself to prevent recursion, and re-dispatches to the chain. Multi-exception aggregates are delegated to the fallback handler.</p><hr><h2 id="_6-configuration-architecture" tabindex="-1">6. Configuration Architecture <a class="header-anchor" href="#_6-configuration-architecture" aria-label="Permalink to &quot;6. Configuration Architecture&quot;">​</a></h2><div class="mermaid"></div><h3 id="configuration-binding-order" tabindex="-1">Configuration binding order <a class="header-anchor" href="#configuration-binding-order" aria-label="Permalink to &quot;Configuration binding order&quot;">​</a></h3><ol><li><code>IConfiguration</code> section binding runs first (from <code>appsettings.json</code>, YAML, environment variables, etc.)</li><li>The inline <code>Action&lt;ErrorHandlingOptions&gt;</code> runs second, so it can override file-based values.</li></ol><h3 id="options-validation" tabindex="-1">Options validation <a class="header-anchor" href="#options-validation" aria-label="Permalink to &quot;Options validation&quot;">​</a></h3><p><code>ErrorHandlingOptionsValidator</code> runs at first <code>IOptions&lt;ErrorHandlingOptions&gt;</code> resolution and validates:</p><ul><li>All <code>JsonFieldNamesOptions</code> properties are non-null and non-whitespace.</li><li>All field name values are unique (no duplicates like <code>code</code> and <code>message</code> mapped to the same JSON key).</li></ul><h3 id="errorhandlingoptions-properties" tabindex="-1">ErrorHandlingOptions properties <a class="header-anchor" href="#errorhandlingoptions-properties" aria-label="Permalink to &quot;ErrorHandlingOptions properties&quot;">​</a></h3><table tabindex="0"><thead><tr><th>Property</th><th>Type</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td><code>Enabled</code></td><td><code>bool</code></td><td><code>true</code></td><td>Enable/disable error handling globally</td></tr><tr><td><code>DefaultErrorCodeStrategy</code></td><td><code>ErrorCodeStrategy</code></td><td><code>AllCaps</code></td><td><code>AllCaps</code> or <code>FullQualifiedName</code></td></tr><tr><td><code>HttpStatusInJsonResponse</code></td><td><code>bool</code></td><td><code>false</code></td><td>Include HTTP status code in JSON body</td></tr><tr><td><code>SearchSuperClassHierarchy</code></td><td><code>bool</code></td><td><code>false</code></td><td>Search base classes for config matches</td></tr><tr><td><code>AddPathToError</code></td><td><code>bool</code></td><td><code>true</code></td><td>Include property path in field errors</td></tr><tr><td><code>OverrideModelStateValidation</code></td><td><code>bool</code></td><td><code>false</code></td><td>Intercept <code>[ApiController]</code> validation</td></tr><tr><td><code>UseProblemDetailFormat</code></td><td><code>bool</code></td><td><code>false</code></td><td>Enable RFC 9457 Problem Details format</td></tr><tr><td><code>ProblemDetailTypePrefix</code></td><td><code>string</code></td><td><code>https://example.com/errors/</code></td><td>Type URI prefix for Problem Details</td></tr><tr><td><code>ProblemDetailConvertToKebabCase</code></td><td><code>bool</code></td><td><code>true</code></td><td>Convert error codes to kebab-case in type URI</td></tr><tr><td><code>ExceptionLogging</code></td><td><code>ExceptionLogging</code></td><td><code>MessageOnly</code></td><td><code>None</code>, <code>MessageOnly</code>, <code>WithStacktrace</code></td></tr><tr><td><code>HttpStatuses</code></td><td><code>Dictionary&lt;string, HttpStatusCode&gt;</code></td><td><code>{}</code></td><td>Exception FQN to HTTP status mappings</td></tr><tr><td><code>Codes</code></td><td><code>Dictionary&lt;string, string&gt;</code></td><td><code>{}</code></td><td>Exception FQN or field-specific error code mappings</td></tr><tr><td><code>Messages</code></td><td><code>Dictionary&lt;string, string&gt;</code></td><td><code>{}</code></td><td>Exception FQN or field-specific message mappings</td></tr><tr><td><code>LogLevels</code></td><td><code>Dictionary&lt;string, LogLevel&gt;</code></td><td><code>{}</code></td><td>HTTP status code/range to log level</td></tr><tr><td><code>FullStacktraceHttpStatuses</code></td><td><code>HashSet&lt;string&gt;</code></td><td><code>{}</code></td><td>HTTP statuses that force full stack trace logging</td></tr><tr><td><code>FullStacktraceClasses</code></td><td><code>HashSet&lt;string&gt;</code></td><td><code>{}</code></td><td>Exception types that force full stack trace logging</td></tr><tr><td><code>JsonFieldNames</code></td><td><code>JsonFieldNamesOptions</code></td><td><em>(defaults)</em></td><td>Custom JSON field names (10 configurable fields)</td></tr><tr><td><code>RateLimiting</code></td><td><code>RateLimitingOptions</code></td><td><em>(defaults)</em></td><td>Rate limiting response options</td></tr><tr><td><code>OpenApi</code></td><td><code>OpenApiOptions</code></td><td><code>DefaultStatusCodes: {400, 404, 500}</code></td><td>OpenAPI schema generation options</td></tr></tbody></table><hr><h2 id="_7-attribute-system-and-metadata-caching" tabindex="-1">7. Attribute System and Metadata Caching <a class="header-anchor" href="#_7-attribute-system-and-metadata-caching" aria-label="Permalink to &quot;7. Attribute System and Metadata Caching&quot;">​</a></h2><p>Three attributes allow exception classes to declare their error response behavior declaratively:</p><div class="mermaid"></div><p><code>ExceptionMetadataCache</code> is a <strong>static, thread-safe</strong> <code>ConcurrentDictionary</code> that reflects on exception types once and caches the results. The <code>DefaultFallbackHandler</code> consults this cache to:</p><ol><li>Use <code>[ResponseErrorCode]</code> as the error code (overrides the <code>IErrorCodeMapper</code> strategy).</li><li>Use <code>[ResponseStatus]</code> as the HTTP status code (overrides the <code>IHttpStatusMapper</code>).</li><li>Extract <code>[ResponseErrorProperty]</code>-decorated properties and add them to <code>ApiErrorResponse.Properties</code> (serialized via <code>[JsonExtensionData]</code>).</li></ol><p>Property names default to camelCase conversion of the C# property name unless overridden via the <code>Name</code> parameter.</p><hr><h2 id="_8-serialization-and-response-writing" tabindex="-1">8. Serialization and Response Writing <a class="header-anchor" href="#_8-serialization-and-response-writing" aria-label="Permalink to &quot;8. Serialization and Response Writing&quot;">​</a></h2><p><code>ErrorResponseWriter</code> caches a single <code>JsonSerializerOptions</code> instance at construction, including the custom <code>ApiErrorResponseConverter</code>. This avoids per-request allocation.</p><div class="mermaid"></div><p><code>ApiErrorResponseConverter</code> is a <strong>write-only</strong> <code>JsonConverter&lt;ApiErrorResponse&gt;</code> that:</p><ul><li>Uses the configured <code>JsonFieldNamesOptions</code> to determine property names at every level.</li><li>Manually writes each nested error model (<code>ApiFieldError</code>, <code>ApiGlobalError</code>, <code>ApiParameterError</code>) with the correct field names.</li><li>Filters <code>Properties</code> (extension data) to avoid collisions with built-in field names.</li><li>The <code>JsonSerializerOptions</code> instance becomes thread-safe after first serialization.</li></ul><hr><h2 id="_9-problemdetails-generation-rfc-9457" tabindex="-1">9. ProblemDetails Generation (RFC 9457) <a class="header-anchor" href="#_9-problemdetails-generation-rfc-9457" aria-label="Permalink to &quot;9. ProblemDetails Generation (RFC 9457)&quot;">​</a></h2><p>When <code>UseProblemDetailFormat</code> is <code>true</code>, <code>ErrorResponseWriter</code> delegates to <code>IProblemDetailFactory</code>.</p><div class="mermaid"></div><p>The <code>type</code> URI is built from <code>ProblemDetailTypePrefix</code> + the error code converted to kebab-case (e.g., <code>VALIDATION_FAILED</code> becomes <code>validation-failed</code>). This is configurable via <code>ProblemDetailConvertToKebabCase</code>.</p><hr><h2 id="_10-localization-architecture" tabindex="-1">10. Localization Architecture <a class="header-anchor" href="#_10-localization-architecture" aria-label="Permalink to &quot;10. Localization Architecture&quot;">​</a></h2><div class="mermaid"></div><p>Localization is a <strong>zero-cost opt-in</strong>. The default <code>NoOpErrorMessageLocalizer</code> is a pass-through. When the user calls <code>AddErrorHandlingLocalization&lt;TResource&gt;()</code>:</p><ol><li><code>AddLocalization()</code> is called to register the Microsoft localization infrastructure.</li><li>The <code>IErrorMessageLocalizer</code> registration is <strong>replaced</strong> with <code>StringLocalizerErrorMessageLocalizer&lt;TResource&gt;</code>.</li><li>Error codes are used as resource keys in <code>.resx</code> files. If no resource is found, the default message is returned.</li></ol><p>Localization runs <strong>after</strong> handler processing and customization in the <code>ErrorHandlingFacade</code>, so it localizes the final message.</p><hr><h2 id="_11-telemetry-and-distributed-tracing" tabindex="-1">11. Telemetry and Distributed Tracing <a class="header-anchor" href="#_11-telemetry-and-distributed-tracing" aria-label="Permalink to &quot;11. Telemetry and Distributed Tracing&quot;">​</a></h2><div class="mermaid"></div><p><code>ErrorHandlingActivitySource</code> exposes a static <code>ActivitySource</code> named <code>&quot;ErrorLens.ErrorHandling&quot;</code>. The facade:</p><ol><li>Starts an activity named <code>&quot;ErrorLens.HandleException&quot;</code> for each exception.</li><li>Only enriches tags/events when <code>activity.IsAllDataRequested == true</code> (zero overhead when no collector is configured).</li><li>Uses OTel semantic conventions for exception events (<code>exception.type</code>, <code>exception.message</code>, <code>exception.stacktrace</code>).</li><li>Sets <code>ActivityStatusCode.Error</code> on the activity.</li></ol><hr><h2 id="_12-rate-limiting-integration" tabindex="-1">12. Rate Limiting Integration <a class="header-anchor" href="#_12-rate-limiting-integration" aria-label="Permalink to &quot;12. Rate Limiting Integration&quot;">​</a></h2><p>Available on <strong>.NET 7+</strong> only (guarded by <code>#if NET7_0_OR_GREATER</code>).</p><div class="mermaid"></div><p>The <code>DefaultRateLimitResponseWriter</code>:</p><ul><li>Reads <code>MetadataName.RetryAfter</code> from the <code>RateLimitLease</code>.</li><li>Sets <code>Retry-After</code> header (always when metadata available).</li><li>Optionally sets the combined <code>RateLimit</code> header (IETF draft format) via <code>UseModernHeaderFormat</code>.</li><li>Optionally includes <code>retryAfter</code> in the JSON body via <code>IncludeRetryAfterInBody</code>.</li><li>Delegates body serialization to the shared <code>ErrorResponseWriter</code> (same format/field name logic).</li></ul><hr><h2 id="_13-openapi-swagger-integration" tabindex="-1">13. OpenAPI / Swagger Integration <a class="header-anchor" href="#_13-openapi-swagger-integration" aria-label="Permalink to &quot;13. OpenAPI / Swagger Integration&quot;">​</a></h2><p>The library provides two parallel packages for API documentation, split by framework generation.</p><div class="mermaid"></div><p>Both integrations:</p><ul><li>Skip status codes already declared on the operation (e.g., via <code>[ProducesResponseType]</code>).</li><li>Add error response schemas for each status code in <code>OpenApiOptions.DefaultStatusCodes</code> (default: 400, 404, 500).</li><li>Choose between standard and Problem Details schemas based on <code>UseProblemDetailFormat</code>.</li><li>Use the configured <code>JsonFieldNamesOptions</code> for property names in the standard schema.</li></ul><hr><h2 id="_14-multi-targeting-strategy" tabindex="-1">14. Multi-Targeting Strategy <a class="header-anchor" href="#_14-multi-targeting-strategy" aria-label="Permalink to &quot;14. Multi-Targeting Strategy&quot;">​</a></h2><div class="mermaid"></div><table tabindex="0"><thead><tr><th>Feature</th><th>.NET 6</th><th>.NET 7</th><th>.NET 8+</th></tr></thead><tbody><tr><td>Middleware (<code>UseErrorHandling()</code>)</td><td>Required</td><td>Required</td><td>Optional</td></tr><tr><td><code>IExceptionHandler</code></td><td>N/A</td><td>N/A</td><td>Auto-registered</td></tr><tr><td>Rate limiting integration</td><td>N/A</td><td>Available</td><td>Available</td></tr></tbody></table><p>The <code>System.Threading.RateLimiting</code> NuGet package reference is conditionally excluded on <code>net6.0</code> via a <code>Condition</code> attribute in the <code>.csproj</code>.</p><hr><h2 id="_15-key-design-decisions" tabindex="-1">15. Key Design Decisions <a class="header-anchor" href="#_15-key-design-decisions" aria-label="Permalink to &quot;15. Key Design Decisions&quot;">​</a></h2><h3 id="_1-facade-pattern-over-mediator" tabindex="-1">1. Facade Pattern over Mediator <a class="header-anchor" href="#_1-facade-pattern-over-mediator" aria-label="Permalink to &quot;1. Facade Pattern over Mediator&quot;">​</a></h3><p>The <code>ErrorHandlingFacade</code> centralizes orchestration rather than using a mediator or event bus. This keeps the call path predictable, debuggable, and synchronous.</p><h3 id="_2-chain-of-responsibility-with-explicit-ordering" tabindex="-1">2. Chain of Responsibility with Explicit Ordering <a class="header-anchor" href="#_2-chain-of-responsibility-with-explicit-ordering" aria-label="Permalink to &quot;2. Chain of Responsibility with Explicit Ordering&quot;">​</a></h3><p>Handlers use a numeric <code>Order</code> property rather than framework-level ordering attributes. Built-in handlers use values 50-150, leaving <code>Order &lt; 50</code> for high-priority custom handlers and <code>Order &gt; 150</code> (default 1000) for standard custom handlers.</p><h3 id="_3-tryadd-for-idempotent-registration" tabindex="-1">3. TryAdd for Idempotent Registration <a class="header-anchor" href="#_3-tryadd-for-idempotent-registration" aria-label="Permalink to &quot;3. TryAdd for Idempotent Registration&quot;">​</a></h3><p>All DI registrations use <code>TryAddSingleton</code> or <code>TryAddEnumerable</code>, meaning:</p><ul><li>Calling <code>AddErrorHandling()</code> multiple times is safe.</li><li>Users can register their own <code>IErrorCodeMapper</code> (etc.) <strong>before</strong> calling <code>AddErrorHandling()</code> to override defaults.</li></ul><h3 id="_4-zero-cost-abstractions-for-optional-features" tabindex="-1">4. Zero-Cost Abstractions for Optional Features <a class="header-anchor" href="#_4-zero-cost-abstractions-for-optional-features" aria-label="Permalink to &quot;4. Zero-Cost Abstractions for Optional Features&quot;">​</a></h3><ul><li><strong>Localization:</strong> <code>NoOpErrorMessageLocalizer</code> is a pass-through; no allocation or lookup occurs.</li><li><strong>Telemetry:</strong> <code>Activity</code> tags are only set when <code>IsAllDataRequested == true</code> (no collector = no cost).</li><li><strong>Customizers:</strong> Empty <code>IEnumerable&lt;IApiErrorResponseCustomizer&gt;</code> means zero iterations.</li></ul><h3 id="_5-cached-serialization-options" tabindex="-1">5. Cached Serialization Options <a class="header-anchor" href="#_5-cached-serialization-options" aria-label="Permalink to &quot;5. Cached Serialization Options&quot;">​</a></h3><p><code>ErrorResponseWriter</code> creates its <code>JsonSerializerOptions</code> (including the custom <code>ApiErrorResponseConverter</code>) once at construction. This avoids per-request allocation.</p><h3 id="_6-security-by-default" tabindex="-1">6. Security by Default <a class="header-anchor" href="#_6-security-by-default" aria-label="Permalink to &quot;6. Security by Default&quot;">​</a></h3><ul><li>5xx errors in <code>DefaultFallbackHandler</code> always return <code>&quot;An unexpected error occurred&quot;</code> to prevent information disclosure.</li><li><code>BadRequestExceptionHandler</code> sanitizes messages containing framework-internal type names (<code>Microsoft.*</code>, <code>System.*</code>).</li></ul><h3 id="_7-static-metadata-cache" tabindex="-1">7. Static Metadata Cache <a class="header-anchor" href="#_7-static-metadata-cache" aria-label="Permalink to &quot;7. Static Metadata Cache&quot;">​</a></h3><p><code>ExceptionMetadataCache</code> uses a static <code>ConcurrentDictionary</code> to avoid repeated reflection on exception types. This is a process-lifetime cache that grows monotonically (appropriate for the bounded set of exception types in any application).</p><h3 id="_8-separate-openapi-packages-by-framework-generation" tabindex="-1">8. Separate OpenAPI Packages by Framework Generation <a class="header-anchor" href="#_8-separate-openapi-packages-by-framework-generation" aria-label="Permalink to &quot;8. Separate OpenAPI Packages by Framework Generation&quot;">​</a></h3><p>Rather than using conditional compilation within a single package, the library ships separate packages: <code>.OpenApi</code> for .NET 9+ and <code>.Swashbuckle</code> for .NET 6-8. Both share the internal <code>ErrorResponseSchemaGenerator</code>.</p><hr><h2 id="_16-public-interface-catalog" tabindex="-1">16. Public Interface Catalog <a class="header-anchor" href="#_16-public-interface-catalog" aria-label="Permalink to &quot;16. Public Interface Catalog&quot;">​</a></h2><h3 id="core-interfaces" tabindex="-1">Core Interfaces <a class="header-anchor" href="#core-interfaces" aria-label="Permalink to &quot;Core Interfaces&quot;">​</a></h3><table tabindex="0"><thead><tr><th>Interface</th><th>Namespace</th><th>Purpose</th></tr></thead><tbody><tr><td><code>IApiExceptionHandler</code></td><td><code>Handlers</code></td><td>Chain of responsibility handler; implement to handle specific exception types</td></tr><tr><td><code>IFallbackApiExceptionHandler</code></td><td><code>Handlers</code></td><td>Catch-all handler when no specific handler matches</td></tr><tr><td><code>IErrorCodeMapper</code></td><td><code>Mappers</code></td><td>Maps exceptions to error code strings</td></tr><tr><td><code>IErrorMessageMapper</code></td><td><code>Mappers</code></td><td>Maps exceptions to human-readable messages</td></tr><tr><td><code>IHttpStatusMapper</code></td><td><code>Mappers</code></td><td>Maps exceptions to HTTP status codes</td></tr><tr><td><code>ILoggingService</code></td><td><code>Services</code></td><td>Logs exception handling events</td></tr><tr><td><code>ILoggingFilter</code></td><td><code>Services</code></td><td>Filters which exceptions should be logged</td></tr><tr><td><code>IApiErrorResponseCustomizer</code></td><td><code>Services</code></td><td>Global post-processing hook for all error responses</td></tr><tr><td><code>IErrorMessageLocalizer</code></td><td><code>Localization</code></td><td>Localizes error messages by error code</td></tr><tr><td><code>IProblemDetailFactory</code></td><td><code>ProblemDetails</code></td><td>Creates RFC 9457 responses from <code>ApiErrorResponse</code></td></tr><tr><td><code>IRateLimitResponseWriter</code></td><td><code>RateLimiting</code></td><td>Writes structured 429 responses (.NET 7+)</td></tr></tbody></table><h3 id="core-classes" tabindex="-1">Core Classes <a class="header-anchor" href="#core-classes" aria-label="Permalink to &quot;Core Classes&quot;">​</a></h3><table tabindex="0"><thead><tr><th>Class</th><th>Namespace</th><th>Purpose</th></tr></thead><tbody><tr><td><code>AbstractApiExceptionHandler</code></td><td><code>Handlers</code></td><td>Base class with <code>Order =&gt; 1000</code> and <code>CreateResponse()</code> helper</td></tr><tr><td><code>ErrorHandlingFacade</code></td><td><code>Services</code></td><td>Central orchestrator for the entire pipeline</td></tr><tr><td><code>ErrorResponseWriter</code></td><td><code>Integration</code></td><td>Writes JSON/Problem Details to <code>HttpContext.Response</code></td></tr><tr><td><code>ErrorHandlingMiddleware</code></td><td><code>Integration</code></td><td><code>IMiddleware</code> for .NET 6/7</td></tr><tr><td><code>ErrorHandlingExceptionHandler</code></td><td><code>Integration</code></td><td><code>IExceptionHandler</code> for .NET 8+</td></tr><tr><td><code>ApiErrorResponse</code></td><td><code>Models</code></td><td>Primary error response model</td></tr><tr><td><code>ApiFieldError</code></td><td><code>Models</code></td><td>Field-level validation error</td></tr><tr><td><code>ApiGlobalError</code></td><td><code>Models</code></td><td>Class-level validation error</td></tr><tr><td><code>ApiParameterError</code></td><td><code>Models</code></td><td>Method parameter validation error</td></tr><tr><td><code>ProblemDetailResponse</code></td><td><code>ProblemDetails</code></td><td>RFC 9457 response model</td></tr><tr><td><code>ErrorHandlingActivitySource</code></td><td><code>Telemetry</code></td><td>Static <code>ActivitySource</code> for OTel tracing</td></tr><tr><td><code>ApiErrorResponseConverter</code></td><td><code>Serialization</code></td><td>Custom JSON converter for configurable field names</td></tr></tbody></table><h3 id="extension-methods" tabindex="-1">Extension Methods <a class="header-anchor" href="#extension-methods" aria-label="Permalink to &quot;Extension Methods&quot;">​</a></h3><table tabindex="0"><thead><tr><th>Method</th><th>Class</th><th>Purpose</th></tr></thead><tbody><tr><td><code>AddErrorHandling()</code></td><td><code>ServiceCollectionExtensions</code></td><td>Register all core services</td></tr><tr><td><code>AddApiExceptionHandler&lt;T&gt;()</code></td><td><code>ServiceCollectionExtensions</code></td><td>Register custom exception handler</td></tr><tr><td><code>AddErrorResponseCustomizer&lt;T&gt;()</code></td><td><code>ServiceCollectionExtensions</code></td><td>Register response customizer</td></tr><tr><td><code>AddErrorHandlingLocalization&lt;T&gt;()</code></td><td><code>ServiceCollectionExtensions</code></td><td>Opt into IStringLocalizer-based localization</td></tr><tr><td><code>UseErrorHandling()</code></td><td><code>ApplicationBuilderExtensions</code></td><td>Add middleware to pipeline (required .NET 6/7)</td></tr><tr><td><code>AddYamlErrorHandling()</code></td><td><code>ConfigurationBuilderExtensions</code></td><td>Add YAML configuration source</td></tr><tr><td><code>AddErrorHandlingOpenApi()</code></td><td><code>OpenApiServiceCollectionExtensions</code></td><td>Add .NET 9+ OpenAPI schemas</td></tr><tr><td><code>AddErrorHandlingSwashbuckle()</code></td><td><code>SwaggerServiceCollectionExtensions</code></td><td>Add Swashbuckle operation filter</td></tr></tbody></table><h3 id="attributes" tabindex="-1">Attributes <a class="header-anchor" href="#attributes" aria-label="Permalink to &quot;Attributes&quot;">​</a></h3><table tabindex="0"><thead><tr><th>Attribute</th><th>Target</th><th>Purpose</th></tr></thead><tbody><tr><td><code>[ResponseErrorCode(&quot;CODE&quot;)]</code></td><td>Class (Exception)</td><td>Override error code for an exception type</td></tr><tr><td><code>[ResponseStatus(HttpStatusCode)]</code></td><td>Class (Exception)</td><td>Override HTTP status for an exception type</td></tr><tr><td><code>[ResponseErrorProperty]</code></td><td>Property (on Exception)</td><td>Include property value in error response JSON</td></tr></tbody></table></div></div></main><footer class="VPDocFooter" data-v-e6f2a212 data-v-1bcd8184><!--[--><!--]--><div class="edit-info" data-v-1bcd8184><div class="edit-link" data-v-1bcd8184><a class="VPLink link vp-external-link-icon no-icon edit-link-button" href="https://github.com/AhmedV20/error-handling-dotnet/edit/main/docs/site/architecture.md" target="_blank" rel="noreferrer" data-v-1bcd8184><!--[--><span class="vpi-square-pen edit-link-icon" data-v-1bcd8184></span> Edit this page on GitHub<!--]--></a></div><!----></div><!----></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><footer class="VPFooter" data-v-d8b57b2d data-v-566314d4><div class="container" data-v-566314d4><p class="message" data-v-566314d4>Released under the MIT License.</p><p class="copyright" data-v-566314d4>Copyright © 2026 ErrorLens</p></div></footer><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"architecture.md\":\"CfYWZbum\",\"changelog.md\":\"DJiLZr_O\",\"documentation.md\":\"BRjyxdJS\",\"features_attributes.md\":\"DoZ8ZE8f\",\"features_custom-handlers.md\":\"CpLZ6ilX\",\"features_json-field-names.md\":\"BdEcjM8I\",\"features_localization.md\":\"CFh_FLx6\",\"features_openapi.md\":\"DOINqOBz\",\"features_problem-details.md\":\"BDvMxu0v\",\"features_rate-limiting.md\":\"DNxVi9Dy\",\"features_response-customization.md\":\"BUfru8jk\",\"features_swashbuckle.md\":\"CG-3TQ0y\",\"features_telemetry.md\":\"BzfWAlYg\",\"guide_configuration.md\":\"dkft_igm\",\"guide_getting-started.md\":\"Bgw6Sne-\",\"guide_logging.md\":\"fgshw631\",\"guide_troubleshooting.md\":\"tbhxOH9H\",\"index.md\":\"Dos1YDJR\",\"reference_api.md\":\"Cm_1LrqF\",\"reference_template.md\":\"BA7_yN_o\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"en-US\",\"dir\":\"ltr\",\"title\":\"ErrorLens.ErrorHandling\",\"description\":\"Consistent, structured error responses for ASP.NET Core REST APIs\",\"base\":\"/error-handling-dotnet/1.3.1/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"logo\":\"/icon.png\",\"nav\":[{\"text\":\"Documentation\",\"link\":\"/documentation\"},{\"text\":\"Changelog\",\"link\":\"/changelog\"},{\"text\":\"v1.3.1\",\"items\":[{\"text\":\"NuGet\",\"link\":\"https://www.nuget.org/packages/ErrorLens.ErrorHandling\"}]}],\"sidebar\":{\"/documentation\":[{\"text\":\"Getting Started\",\"items\":[{\"text\":\"Installation\",\"link\":\"/documentation#installation\"},{\"text\":\"Quick Start\",\"link\":\"/documentation#quick-start\"},{\"text\":\"How It Works\",\"link\":\"/documentation#how-it-works\"},{\"text\":\"HTTP Status Mappings\",\"link\":\"/documentation#default-http-status-mappings\"},{\"text\":\"Error Code Strategies\",\"link\":\"/documentation#error-code-strategies\"}]},{\"text\":\"Configuration\",\"items\":[{\"text\":\"Configuration\",\"link\":\"/documentation#configuration\"},{\"text\":\"JSON Field Names\",\"link\":\"/documentation#custom-json-field-names\"}]},{\"text\":\"Core Features\",\"items\":[{\"text\":\"Exception Attributes\",\"link\":\"/documentation#exception-attributes\"},{\"text\":\"Custom Handlers\",\"link\":\"/documentation#custom-exception-handlers\"},{\"text\":\"Validation Errors\",\"link\":\"/documentation#validation-errors\"},{\"text\":\"Response Customization\",\"link\":\"/documentation#response-customization\"},{\"text\":\"Replaceable Mappers\",\"link\":\"/documentation#replaceable-mappers\"},{\"text\":\"Problem Details\",\"link\":\"/documentation#rfc-9457-problem-details\"}]},{\"text\":\"Security & Logging\",\"items\":[{\"text\":\"Security\",\"link\":\"/documentation#security\"},{\"text\":\"Logging\",\"link\":\"/documentation#logging\"}]},{\"text\":\"Integrations\",\"items\":[{\"text\":\"OpenTelemetry\",\"link\":\"/documentation#opentelemetry-tracing\"},{\"text\":\"Localization\",\"link\":\"/documentation#localization\"},{\"text\":\"OpenAPI & Swagger\",\"link\":\"/documentation#openapi-swagger-integration\"},{\"text\":\"Rate Limiting\",\"link\":\"/documentation#rate-limiting\"}]},{\"text\":\"Reference\",\"items\":[{\"text\":\"Error Code Constants\",\"link\":\"/documentation#built-in-error-code-constants\"},{\"text\":\"API Reference\",\"link\":\"/documentation#api-reference\"},{\"text\":\"Architecture\",\"link\":\"/architecture\"},{\"text\":\"Config Template\",\"link\":\"/documentation#configuration-template\"},{\"text\":\"Troubleshooting\",\"link\":\"/documentation#troubleshooting\"}]}]},\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/AhmedV20/error-handling-dotnet\"}],\"editLink\":{\"pattern\":\"https://github.com/AhmedV20/error-handling-dotnet/edit/main/docs/site/:path\",\"text\":\"Edit this page on GitHub\"},\"footer\":{\"message\":\"Released under the MIT License.\",\"copyright\":\"Copyright © 2026 ErrorLens\"},\"search\":{\"provider\":\"local\"},\"outline\":{\"level\":[2,3]}},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":false}");</script>
    
  </body>
</html>