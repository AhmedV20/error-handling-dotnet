import{_ as o,o as i,c as l,ag as t}from"./chunks/framework.BvfOCw1h.js";const g=JSON.parse('{"title":"Changelog","description":"","frontmatter":{},"headers":[],"relativePath":"changelog.md","filePath":"changelog.md"}'),r={name:"changelog.md"};function a(n,e,d,s,c,p){return i(),l("div",null,[...e[0]||(e[0]=[t('<h1 id="changelog" tabindex="-1">Changelog <a class="header-anchor" href="#changelog" aria-label="Permalink to &quot;Changelog&quot;">​</a></h1><p>All notable changes to ErrorLens.ErrorHandling will be documented in this file.</p><p>The format is based on <a href="https://keepachangelog.com/en/1.1.0/" target="_blank" rel="noreferrer">Keep a Changelog</a>, and this project adheres to <a href="https://semver.org/spec/v2.0.0.html" target="_blank" rel="noreferrer">Semantic Versioning</a>.</p><h2 id="unreleased" tabindex="-1">[Unreleased] <a class="header-anchor" href="#unreleased" aria-label="Permalink to &quot;[Unreleased]&quot;">​</a></h2><h2 id="_1-3-0-2026-02-16" tabindex="-1">[1.3.0] - 2026-02-16 <a class="header-anchor" href="#_1-3-0-2026-02-16" aria-label="Permalink to &quot;[1.3.0] - 2026-02-16&quot;">​</a></h2><h3 id="breaking-changes" tabindex="-1">Breaking Changes <a class="header-anchor" href="#breaking-changes" aria-label="Permalink to &quot;Breaking Changes&quot;">​</a></h3><ul><li><strong><code>AddExceptionHandler&lt;T&gt;()</code> renamed to <code>AddApiExceptionHandler&lt;T&gt;()</code></strong><ul><li>Method renamed to avoid collision with ASP.NET Core 8+ built-in <code>AddExceptionHandler&lt;T&gt;()</code></li><li><strong>Migration</strong>: Update any custom handler registrations from <code>AddExceptionHandler&lt;MyHandler&gt;()</code> to <code>AddApiExceptionHandler&lt;MyHandler&gt;()</code></li></ul></li></ul><h3 id="added" tabindex="-1">Added <a class="header-anchor" href="#added" aria-label="Permalink to &quot;Added&quot;">​</a></h3><ul><li><p><strong>OpenTelemetry Distributed Tracing</strong></p><ul><li><code>ErrorHandlingActivitySource</code> with shared <code>ActivitySource</code> (&quot;ErrorLens.ErrorHandling&quot;)</li><li>Automatic <code>Activity</code> spans in <code>ErrorHandlingFacade.HandleException()</code> with OTel semantic conventions</li><li>Tags: <code>error.code</code>, <code>error.type</code>, <code>http.response.status_code</code></li><li>Exception event with <code>exception.type</code>, <code>exception.message</code>, <code>exception.stacktrace</code></li><li>Zero new dependencies — uses <code>System.Diagnostics.Activity</code> from runtime</li><li>Zero overhead when no <code>ActivityListener</code> is subscribed</li></ul></li><li><p><strong>Error Message Localization</strong></p><ul><li><code>IErrorMessageLocalizer</code> abstraction with <code>Localize()</code> and <code>LocalizeFieldError()</code> methods</li><li><code>NoOpErrorMessageLocalizer</code> default (pass-through, registered via <code>TryAddSingleton</code>)</li><li><code>StringLocalizerErrorMessageLocalizer&lt;TResource&gt;</code> bridge to <code>IStringLocalizer&lt;T&gt;</code></li><li>Opt-in via <code>AddErrorHandlingLocalization&lt;TResource&gt;()</code></li><li>Localizes top-level message, field errors, global errors, and parameter errors</li><li>New dependency: <code>Microsoft.Extensions.Localization.Abstractions 8.0.0</code></li></ul></li><li><p><strong>New Package: ErrorLens.ErrorHandling.OpenApi</strong> (.NET 9+)</p><ul><li><code>ErrorResponseOperationTransformer</code> implementing <code>IOpenApiOperationTransformer</code></li><li>Auto-adds error response schemas (400, 404, 500) to all OpenAPI operations</li><li>Respects existing <code>[ProducesResponseType]</code> attributes</li><li>Reflects <code>UseProblemDetailFormat</code> and custom <code>JsonFieldNamesOptions</code> in generated schemas</li><li>Setup: <code>services.AddErrorHandlingOpenApi()</code></li></ul></li><li><p><strong>New Package: ErrorLens.ErrorHandling.Swashbuckle</strong> (.NET 6-8)</p><ul><li><code>ErrorResponseOperationFilter</code> implementing <code>IOperationFilter</code></li><li>Same auto-schema behavior as OpenApi package for Swashbuckle/Swagger</li><li>Setup: <code>services.AddErrorHandlingSwashbuckle()</code></li></ul></li><li><p><strong>Rate Limiting Integration</strong> (.NET 7+)</p><ul><li><code>IRateLimitResponseWriter</code> interface for structured 429 responses</li><li><code>DefaultRateLimitResponseWriter</code> with <code>Retry-After</code> and <code>RateLimit</code> headers</li><li><code>RateLimitingOptions</code> for configuring error code, message, and header format</li><li>Optional <code>retryAfter</code> property in response body</li><li>Supports localized rate limit messages</li></ul></li><li><p><strong><code>ErrorResponseWriter</code></strong></p><ul><li>Centralized response writing extracted into shared service</li><li>Caches <code>JsonSerializerOptions</code> for performance</li></ul></li><li><p><strong><code>ErrorHandlingOptionsValidator</code></strong></p><ul><li>Validates <code>JsonFieldNamesOptions</code> at startup (null, empty, duplicate checks)</li></ul></li><li><p><strong>AggregateExceptionHandler</strong> (Order 50)</p><ul><li>Built-in handler for <code>AggregateException</code> types</li><li>Unwraps single-inner-exception aggregates and re-dispatches to appropriate specific handler</li><li>Multi-exception aggregates delegate to fallback handler</li><li>Automatically registered with default configuration</li></ul></li><li><p><strong>5xx Safe Message Behavior</strong></p><ul><li>All 5xx-class errors (500-599) now return generic safe message: &quot;An unexpected error occurred&quot;</li><li>Prevents information disclosure of internal system details (database connection strings, file paths, stack traces)</li><li>4xx errors preserve original user-facing messages</li></ul></li><li><p><strong>TypeMismatchExceptionHandler Generic Message</strong></p><ul><li>Handler now returns generic &quot;A type conversion error occurred&quot; message</li><li>Prevents exposure of internal type conversion details</li></ul></li><li><p><strong>BadRequestStatusCode Usage</strong></p><ul><li>Handler now uses actual <code>StatusCode</code> property from <code>BadHttpRequestException</code></li><li>Correctly returns 400, 408, 413, etc. based on framework&#39;s status code</li></ul></li><li><p><strong>Message Sanitization</strong></p><ul><li><code>BadRequestExceptionHandler</code> sanitizes Kestrel-internal error messages</li><li>Replaces framework-specific details with safe &quot;Bad request&quot; message</li></ul></li><li><p><strong>OperationCanceledException → 499</strong></p><ul><li><code>OperationCanceledException</code> and <code>TaskCanceledException</code> now map to HTTP 499 (Client Closed Request)</li><li>Follows nginx convention for client-disconnected requests</li></ul></li><li><p><strong>reloadOnChange Default Changed</strong></p><ul><li>YAML configuration <code>reloadOnChange</code> now defaults to <code>false</code></li><li>Documented that application restart is required for config changes</li></ul></li><li><p><strong>ResponseErrorPropertyAttribute Cleanup</strong></p><ul><li>Removed <code>AttributeTargets.Method</code> from <code>AttributeUsage</code></li><li>Now targets <code>AttributeTargets.Property</code> only (as documented)</li></ul></li></ul><h3 id="changed" tabindex="-1">Changed <a class="header-anchor" href="#changed" aria-label="Permalink to &quot;Changed&quot;">​</a></h3><ul><li><code>AddApiExceptionHandler&lt;T&gt;()</code> now uses <code>TryAddEnumerable</code> for idempotent registration (prevents duplicates on double-call)</li><li><code>AddErrorResponseCustomizer&lt;T&gt;()</code> now uses <code>TryAddEnumerable</code> for idempotent registration</li><li>Integration packages use <code>IOptions&lt;T&gt;</code> pattern instead of <code>BuildServiceProvider()</code> anti-pattern</li><li>All package versions aligned to 1.3.0</li></ul><h3 id="removed" tabindex="-1">Removed <a class="header-anchor" href="#removed" aria-label="Permalink to &quot;Removed&quot;">​</a></h3><ul><li><code>IHttpStatusFromExceptionMapper</code> interface (orphaned, never implemented or registered)</li><li><code>DefaultLoggingFilter</code> class (replaced by <code>ILoggingFilter</code> enumerable pattern)</li></ul><h3 id="fixed" tabindex="-1">Fixed <a class="header-anchor" href="#fixed" aria-label="Permalink to &quot;Fixed&quot;">​</a></h3><ul><li><p><strong>Operator Precedence Bug</strong></p><ul><li><code>ModelStateValidationExceptionHandler.InferValidationType</code> fixed with explicit parentheses</li><li>Messages containing &quot;json&quot; no longer misclassified when combined with other keywords</li></ul></li><li><p><strong>Safe Pattern Matching</strong></p><ul><li>All handler <code>Handle()</code> methods now use safe pattern matching (<code>is not</code>)</li><li>Prevents <code>InvalidCastException</code> when handlers called without prior <code>CanHandle()</code> check</li></ul></li><li><p><strong>Unified ToCamelCase</strong></p><ul><li><code>StringUtils.ToCamelCase</code> now shared across <code>ModelStateValidationExceptionHandler</code>, <code>ValidationExceptionHandler</code>, and <code>ExceptionMetadataCache</code></li><li>Ensures consistent dotted-path handling (e.g., <code>Address.ZipCode</code> → <code>address.zipCode</code>)</li></ul></li><li><p><strong>ErrorCodeMapper Acronym Regex</strong></p><ul><li>Fixed regex to correctly handle consecutive uppercase letters (acronyms)</li><li><code>HTTPConnection</code> → <code>HTTP_CONNECTION</code> (not <code>H_T_T_P_CONNECTION</code>)</li><li><code>IOError</code> → <code>IO_ERROR</code> (not <code>I_O_ERROR</code>)</li></ul></li><li><p><strong>Null Safety</strong></p><ul><li>Added <code>ArgumentNullException.ThrowIfNull</code> guards to all model constructors</li><li>Added <code>ArgumentOutOfRangeException</code> for <code>ResponseStatusAttribute</code> (valid HTTP range: 100-599)</li></ul></li><li><p><strong>Serialization Fixes</strong></p><ul><li><code>ApiErrorResponseConverter</code> filters duplicate JSON keys (extension properties matching built-in field names)</li><li><code>RejectedValue</code> serialization now passes parent <code>JsonSerializerOptions</code> for consistent naming policy</li><li><code>ApiErrorResponseConverter.Read</code> throws <code>NotSupportedException</code> (write-only contract)</li></ul></li><li><p><strong>ProblemDetailFactory Fixes</strong></p><ul><li><code>ProblemDetailConvertToKebabCase</code> option now respected (false skips kebab-case conversion)</li><li>Extension keys can no longer overwrite library-set keys (<code>type</code>, <code>title</code>, <code>status</code>, etc.)</li><li>List contents copied instead of sharing mutable references</li></ul></li><li><p><strong>Pipeline Resilience</strong></p><ul><li><code>ErrorResponseWriter</code> checks <code>Response.HasStarted</code> before writing (graceful skip if response already started)</li><li><code>ErrorHandlingMiddleware</code> passes <code>context.RequestAborted</code> as <code>CancellationToken</code> to response writer</li><li><code>ErrorHandlingFacade</code> uses <code>ExceptionDispatchInfo.Capture(exception).Throw()</code> to preserve stack trace when disabled</li><li><code>ErrorHandlingFacade</code> materializes <code>_customizers</code> with <code>.ToList()</code> to prevent lazy enumerable issues</li><li>Safety-net in facade logs both handler exception AND original exception when handler throws</li></ul></li><li><p><strong>DI Improvements</strong></p><ul><li>Built-in handler registrations use <code>TryAddEnumerable</code> for idempotency</li><li>Multiple <code>AddErrorHandling()</code> calls no longer create duplicate handler registrations</li></ul></li></ul><h3 id="test-coverage" tabindex="-1">Test Coverage <a class="header-anchor" href="#test-coverage" aria-label="Permalink to &quot;Test Coverage&quot;">​</a></h3><ul><li><p><strong>New Tests</strong>: 165 new tests added (total: 350 tests, up from 185)</p><ul><li>Null safety tests for all model constructors</li><li>Range validation tests for <code>ResponseStatusAttribute</code></li><li>Startup validation tests for <code>JsonFieldNamesOptions</code></li><li>Handler tests: <code>AggregateExceptionHandler</code>, <code>TypeMismatchExceptionHandler</code>, <code>BadRequestExceptionHandler</code></li><li>Mapper tests: acronym regex, <code>OperationCanceledException</code> → 499</li><li>Integration tests: middleware, exception handler, DI registration</li><li>Security tests: 10+ information disclosure scenarios</li><li>Serialization tests: duplicate key filtering, <code>RejectedValue</code> options, <code>Read</code> throws</li></ul></li><li><p><strong>Fixed Tests</strong></p><ul><li><code>ErrorResponseWriterTests</code>: Replaced false-positive caching and cancellation tests with real assertions</li><li><code>ProblemDetailFactoryTests</code>: Fixed swapped <code>ApiFieldError</code> constructor args</li><li><code>LoggingServiceTests</code>: Replaced weak <code>.ReceivedCalls()</code> assertions with specific log level verification</li><li><code>ErrorHandlingFacadeTests</code>: Added safety-net test (handler throws → both exceptions logged)</li></ul></li><li><p><strong>Coverage</strong>: 93.1% line coverage (exceeds 90% requirement)</p></li></ul><h3 id="ci-cd" tabindex="-1">CI/CD <a class="header-anchor" href="#ci-cd" aria-label="Permalink to &quot;CI/CD&quot;">​</a></h3><ul><li>CI and Release workflows updated to pack and publish all 3 NuGet packages</li><li>Release summary includes links for all 3 packages</li></ul><h2 id="_1-1-1-2026-02-12" tabindex="-1">[1.1.1] - 2026-02-12 <a class="header-anchor" href="#_1-1-1-2026-02-12" aria-label="Permalink to &quot;[1.1.1] - 2026-02-12&quot;">​</a></h2><h3 id="fixed-1" tabindex="-1">Fixed <a class="header-anchor" href="#fixed-1" aria-label="Permalink to &quot;Fixed&quot;">​</a></h3><ul><li><p><strong>Critical Bug</strong>: <code>ILoggingService</code> was not registered in DI container, causing exception logging to be silently disabled in v1.1.0</p><ul><li>Added <code>services.TryAddSingleton&lt;ILoggingService, LoggingService&gt;()</code> to <code>RegisterCoreServices()</code></li><li>Logging now works correctly with all providers (console, Seq, Serilog, etc.)</li></ul></li><li><p><strong>Documentation</strong>: Handler ordering table in <code>custom-handlers.md</code> and <code>index.adoc</code> now clearly marks <code>JsonExceptionHandler</code> and <code>TypeMismatchExceptionHandler</code> as opt-in (not registered by default)</p></li></ul><h3 id="added-1" tabindex="-1">Added <a class="header-anchor" href="#added-1" aria-label="Permalink to &quot;Added&quot;">​</a></h3><ul><li><strong>Sample Project READMEs</strong>: Comprehensive documentation for all three samples <ul><li>MinimalApiSample: Zero-config setup guide with curl examples</li><li>FullApiSample: Custom handlers and customizers walkthrough</li><li>ShowcaseSample: Feature matrix with YAML config explanation</li></ul></li></ul><h2 id="_1-1-0-2026-02-11" tabindex="-1">[1.1.0] - 2026-02-11 <a class="header-anchor" href="#_1-1-0-2026-02-11" aria-label="Permalink to &quot;[1.1.0] - 2026-02-11&quot;">​</a></h2><h3 id="added-2" tabindex="-1">Added <a class="header-anchor" href="#added-2" aria-label="Permalink to &quot;Added&quot;">​</a></h3><ul><li><p><strong>Custom JSON Field Names</strong></p><ul><li><code>JsonFieldNamesOptions</code> now fully wired into serialization pipeline</li><li>Custom <code>ApiErrorResponseConverter</code> for runtime-configurable field names</li><li>Rename any JSON property: <code>code</code> → <code>type</code>, <code>message</code> → <code>detail</code>, etc.</li><li>Applies to top-level response and all nested error objects</li><li>Expanded from 5 to 10 configurable field names (added Status, Property, RejectedValue, Path, Parameter)</li></ul></li><li><p><strong>YAML Configuration Support</strong></p><ul><li><code>AddYamlErrorHandling()</code> extension method for <code>IConfigurationBuilder</code></li><li>Full <code>errorhandling.yml</code> template with all options documented</li><li>Same <code>ErrorHandling</code> section name as JSON configuration</li><li>Dependency: NetEscapades.Configuration.Yaml 3.1.0</li></ul></li><li><p><strong>ShowcaseSample Project</strong></p><ul><li>Comprehensive sample demonstrating all features in one project</li><li>5 controllers: BasicErrors, Validation, Attributes, ConfigDriven, ProblemDetails</li><li>Custom exception handler (InfrastructureExceptionHandler)</li><li>Response customizer (RequestMetadataCustomizer) with traceId, timestamp, path</li><li>YAML configuration with custom field names, exception mappings, log levels</li></ul></li><li><p><strong>Professional Documentation</strong></p><ul><li>AsciiDoc index page (<code>docs/index.adoc</code>) with feature matrix</li><li>Guides: Getting Started, Configuration, Validation Errors, Logging</li><li>Features: Custom Handlers, Attributes, Response Customization, Problem Details, JSON Field Names</li><li>API Reference with all public types, interfaces, and extension methods</li><li>Full YAML configuration template</li></ul></li><li><p><strong>OverrideModelStateValidation Option</strong></p><ul><li>Opt-in interception of <code>[ApiController]</code> automatic model validation</li><li>Returns ErrorLens structured <code>fieldErrors</code> format instead of ASP.NET Core&#39;s default <code>ProblemDetails</code></li><li><code>ModelStateValidationExceptionHandler</code> (Order 90) converts <code>ModelStateDictionary</code> into structured response</li><li>Configurable via code, JSON, or YAML (<code>OverrideModelStateValidation: true</code>)</li></ul></li><li><p><strong>Expanded Test Coverage</strong></p><ul><li>18 unit tests for ApiErrorResponseConverter</li><li>5 integration tests for JsonFieldNames end-to-end</li><li>10 integration tests for YAML configuration binding</li><li>Total: 175 tests (up from 142)</li></ul></li></ul><h3 id="changed-1" tabindex="-1">Changed <a class="header-anchor" href="#changed-1" aria-label="Permalink to &quot;Changed&quot;">​</a></h3><ul><li>README.md rewritten with badges, YAML/JSON side-by-side config, custom field names section, samples table</li></ul><h2 id="_1-0-0-2026-02-10" tabindex="-1">[1.0.0] - 2026-02-10 <a class="header-anchor" href="#_1-0-0-2026-02-10" aria-label="Permalink to &quot;[1.0.0] - 2026-02-10&quot;">​</a></h2><h3 id="added-3" tabindex="-1">Added <a class="header-anchor" href="#added-3" aria-label="Permalink to &quot;Added&quot;">​</a></h3><ul><li><p><strong>Zero-Config Exception Handling</strong></p><ul><li>Automatic structured JSON error responses for all unhandled exceptions</li><li>Default error code generation using ALL_CAPS strategy</li><li>HTTP status code mapping based on exception types</li></ul></li><li><p><strong>Validation Error Support</strong></p><ul><li>Field-level validation error details with <code>fieldErrors</code> array</li><li>Property name, error code, message, and rejected value included</li><li>Support for DataAnnotations validation exceptions</li><li>Global and parameter-level error support</li></ul></li><li><p><strong>Configuration via appsettings.json</strong></p><ul><li>Custom error codes per exception type</li><li>Custom error messages per exception type</li><li>HTTP status code overrides</li><li>Field-specific error code/message customization</li><li>Superclass hierarchy search option</li></ul></li><li><p><strong>Custom Exception Attributes</strong></p><ul><li><code>[ResponseErrorCode]</code> - Define custom error code on exception class</li><li><code>[ResponseErrorProperty]</code> - Include exception property in response</li><li><code>[ResponseStatus]</code> - Define HTTP status code on exception class</li><li>Reflection caching for performance</li></ul></li><li><p><strong>Custom Exception Handlers</strong></p><ul><li><code>IApiExceptionHandler</code> interface for custom handling</li><li><code>AbstractApiExceptionHandler</code> base class with default Order</li><li>Priority ordering (lower Order = higher priority)</li><li>Built-in handlers: ModelStateValidation, Validation, BadRequest (Json and TypeMismatch available but not registered by default)</li></ul></li><li><p><strong>RFC 9457 Problem Details Format</strong></p><ul><li>Optional RFC 9457 compliant response format</li><li>Configurable type URI prefix</li><li>Automatic kebab-case conversion for error codes</li><li>Extension properties for additional data</li></ul></li><li><p><strong>Logging Configuration</strong></p><ul><li>Configurable logging verbosity (None, MessageOnly, WithStacktrace)</li><li>Per-HTTP-status log level configuration</li><li>Full stacktrace options per status code or exception type</li><li>Custom logging filters</li></ul></li><li><p><strong>Response Customization</strong></p><ul><li><code>IApiErrorResponseCustomizer</code> interface</li><li>Add global properties to all error responses</li><li>Multiple customizers with order of execution</li></ul></li><li><p><strong>Multi-Target Framework Support</strong></p><ul><li>.NET 6.0, 7.0, 8.0, 9.0, 10.0</li><li><code>IExceptionHandler</code> for .NET 8+ (native)</li><li><code>IMiddleware</code> for .NET 6/7 (fallback)</li></ul></li></ul><h3 id="technical-details" tabindex="-1">Technical Details <a class="header-anchor" href="#technical-details" aria-label="Permalink to &quot;Technical Details&quot;">​</a></h3><ul><li>System.Text.Json for serialization</li><li>Thread-safe reflection caching with ConcurrentDictionary</li><li>Minimal dependencies (Microsoft.Extensions.Options, Microsoft.Extensions.Logging.Abstractions)</li><li>Full XML documentation</li><li>142 unit and integration tests</li></ul>',34)])])}const h=o(r,[["render",a]]);export{g as __pageData,h as default};
