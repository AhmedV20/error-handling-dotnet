import{_ as e,o as a,c as i,ag as t}from"./chunks/framework.DzYrFDJH.js";const k=JSON.parse('{"title":"OpenTelemetry Distributed Tracing","description":"","frontmatter":{},"headers":[],"relativePath":"features/telemetry.md","filePath":"features/telemetry.md"}'),n={name:"features/telemetry.md"};function p(r,s,l,d,o,h){return a(),i("div",null,[...s[0]||(s[0]=[t(`<h1 id="opentelemetry-distributed-tracing" tabindex="-1">OpenTelemetry Distributed Tracing <a class="header-anchor" href="#opentelemetry-distributed-tracing" aria-label="Permalink to &quot;OpenTelemetry Distributed Tracing&quot;">​</a></h1><p>ErrorLens automatically creates <code>Activity</code> spans via <code>System.Diagnostics.Activity</code> when exceptions are handled. Zero new NuGet dependencies — uses runtime-provided APIs only.</p><h2 id="setup" tabindex="-1">Setup <a class="header-anchor" href="#setup" aria-label="Permalink to &quot;Setup&quot;">​</a></h2><p>Wire the ErrorLens activity source into your OpenTelemetry configuration:</p><div class="language-csharp vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">csharp</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">builder.Services.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">AddOpenTelemetry</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">WithTracing</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tracing</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        tracing</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">AddSource</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;ErrorLens.ErrorHandling&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">AddAspNetCoreInstrumentation</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">AddOtlpExporter</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    });</span></span></code></pre></div><h2 id="span-details" tabindex="-1">Span Details <a class="header-anchor" href="#span-details" aria-label="Permalink to &quot;Span Details&quot;">​</a></h2><p>Each handled exception creates an activity named <code>ErrorLens.HandleException</code> with:</p><table tabindex="0"><thead><tr><th>Tag</th><th>Description</th></tr></thead><tbody><tr><td><code>error.code</code></td><td>The ErrorLens error code</td></tr><tr><td><code>error.type</code></td><td>The exception type name</td></tr><tr><td><code>http.response.status_code</code></td><td>The HTTP status code returned</td></tr></tbody></table><p>An exception event is added using OTel semantic conventions:</p><table tabindex="0"><thead><tr><th>Event Attribute</th><th>Description</th></tr></thead><tbody><tr><td><code>exception.type</code></td><td>Fully qualified exception type</td></tr><tr><td><code>exception.message</code></td><td>Exception message</td></tr><tr><td><code>exception.stacktrace</code></td><td>Exception stack trace</td></tr></tbody></table><p>The activity status is set to <code>Error</code>.</p><h2 id="console-exporter-for-debugging" tabindex="-1">Console Exporter for Debugging <a class="header-anchor" href="#console-exporter-for-debugging" aria-label="Permalink to &quot;Console Exporter for Debugging&quot;">​</a></h2><div class="language-csharp vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">csharp</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">builder.Services.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">AddOpenTelemetry</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">WithTracing</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tracing</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        tracing</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">AddSource</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;ErrorLens.ErrorHandling&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            .</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">AddConsoleExporter</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    });</span></span></code></pre></div><p>Example output:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Activity.TraceId:   a1b2c3d4e5f6a1b2c3d4e5f6a1b2c3d4</span></span>
<span class="line"><span>Activity.SpanId:    1a2b3c4d5e6f7a8b</span></span>
<span class="line"><span>Activity.DisplayName: ErrorLens.HandleException</span></span>
<span class="line"><span>Activity.Tags:</span></span>
<span class="line"><span>    error.code: USER_NOT_FOUND</span></span>
<span class="line"><span>    error.type: UserNotFoundException</span></span>
<span class="line"><span>    http.response.status_code: 404</span></span>
<span class="line"><span>Activity.Events:</span></span>
<span class="line"><span>    exception [exception.type=UserNotFoundException, exception.message=User abc-123 not found]</span></span>
<span class="line"><span>Activity.Status: Error</span></span></code></pre></div><h2 id="no-listener-no-overhead" tabindex="-1">No Listener, No Overhead <a class="header-anchor" href="#no-listener-no-overhead" aria-label="Permalink to &quot;No Listener, No Overhead&quot;">​</a></h2><p>When no <code>ActivityListener</code> is registered for the <code>&quot;ErrorLens.ErrorHandling&quot;</code> source, <code>Activity.StartActivity()</code> returns <code>null</code> and all tag-setting and event-recording code is skipped. Tracing adds zero measurable overhead when not configured.</p>`,17)])])}const E=e(n,[["render",p]]);export{k as __pageData,E as default};
